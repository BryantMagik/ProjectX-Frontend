<div class="projects-container">
  <div class="projects-header">
    <div class="header-content">
      <div class="header-title">
        <i class="pi pi-briefcase text-3xl"></i>
        <div>
          <h1 class="title">Projects</h1>
          <p class="subtitle">Manage your workspace projects</p>
        </div>
      </div>
      <button class="btn-primary" (click)="navigateToProjectForm()">
        <i class="pi pi-plus"></i>
        New Project
      </button>
    </div>
  </div>

  <div class="filters-section">
    <div class="search-box">
      <i class="pi pi-search search-icon"></i>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()"
        placeholder="Search projects by name, code, or description..."
        class="search-input"
      />
    </div>
  </div>

  <div class="stats-cards">
    <div class="stat-card">
      <div class="stat-icon stat-total">
        <i class="pi pi-list"></i>
      </div>
      <div class="stat-info">
        <p class="stat-value">{{ filteredProjects.length }}</p>
        <p class="stat-label">Total Projects</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-active">
        <i class="pi pi-clock"></i>
      </div>
      <div class="stat-info">
        <p class="stat-value">{{ getActiveProjectsCount() }}</p>
        <p class="stat-label">Active</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-completed">
        <i class="pi pi-check-circle"></i>
      </div>
      <div class="stat-info">
        <p class="stat-value">{{ getCompletedProjectsCount() }}</p>
        <p class="stat-label">Completed</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-ongoing">
        <i class="pi pi-sync"></i>
      </div>
      <div class="stat-info">
        <p class="stat-value">{{ getOngoingProjectsCount() }}</p>
        <p class="stat-label">Ongoing</p>
      </div>
    </div>
  </div>

  @if (loading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading projects...</p>
    </div>
  }

  @if (error && !loading) {
    <div class="error-state">
      <i class="pi pi-exclamation-circle"></i>
      <p>{{ error }}</p>
    </div>
  }

  @if (!loading && !error) {
    @if (filteredProjects.length === 0) {
      <div class="empty-state">
        <i class="pi pi-inbox"></i>
        <h3>No projects found</h3>
        <p>{{ searchTerm ? 'Try adjusting your search' : 'Create your first project to get started' }}</p>
      </div>
    } @else {
      <div class="projects-grid">
        @for (proj of filteredProjects; track proj.id) {
          <div class="project-card" (click)="navigateToProject(proj.id)" title="View Project Details">
            <div class="project-header">
              @if (proj.image) {
                <img [src]="proj.image" alt="{{proj.name}}" class="project-image">
              } @else {
                <div class="project-image-placeholder">
                  <i class="pi pi-folder text-6xl"></i>
                </div>
              }
              <div class="project-overlay">
                <span class="project-code">{{ proj.code }}</span>
              </div>
            </div>

            <div class="project-body">
              <div class="project-title-row">
                <h3 class="project-title">{{ proj.name }}</h3>
                <span class="project-status" [ngClass]="'status-' + proj.status.toLowerCase()">
                  {{ proj.status }}
                </span>
              </div>

              @if (proj.description) {
                <p class="project-description">{{ proj.description }}</p>
              } @else {
                <p class="project-description no-description">No description available</p>
              }

              <div class="project-tags">
                <span class="project-tag tag-type">{{ proj.type }}</span>
                @if (proj.visibility) {
                  <span class="project-tag tag-visibility">
                    <i class="pi" [ngClass]="proj.visibility === 'public' ? 'pi-eye' : 'pi-lock'"></i>
                    {{ proj.visibility }}
                  </span>
                }
              </div>

              <div class="project-footer">
                <div class="project-author">
                  <div class="author-avatar">
                    @if (proj.author.profile_picture) {
                      <img [src]="proj.author.profile_picture" alt="{{proj.author.first_name}}">
                    } @else {
                      <span>{{ proj.author.first_name[0] || 'U' }}{{ proj.author.last_name[0] || '' }}</span>
                    }
                  </div>
                  <span class="author-name">{{ proj.author.first_name || 'Unknown' }} {{ proj.author.last_name || '' }}</span>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    }
  }
</div>
