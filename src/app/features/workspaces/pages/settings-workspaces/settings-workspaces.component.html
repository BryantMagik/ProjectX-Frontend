<section class="workspace-settings">
  @if (successMessage) {
    <div class="notice success">
      <i class="pi pi-check-circle mr-2"></i>
      {{ successMessage }}
    </div>
  }

  @if (error && !loading) {
    <div class="notice error">
      <i class="pi pi-exclamation-triangle mr-2"></i>
      {{ error }}
    </div>
  }

  @if (loading) {
    <div class="state-card">
      <i class="pi pi-spin pi-spinner"></i>
      <p>Cargando configuracion del workspace...</p>
    </div>
  }

  @if (!loading && workspace) {
    <header class="hero">
      <div class="hero-copy">
        <p class="eyebrow">Workspace</p>
        <h1>{{ workspace.name }}</h1>
        <p class="subtext">Administra la identidad, descripcion y acceso.</p>
      </div>
      <div class="hero-panel">
        <div class="panel-row">
          <div class="kpi">
            <span class="kpi-label">Creado</span>
            <span class="kpi-value">{{ workspace.createdAt | date:'short' }}</span>
            <span class="kpi-meta">Fecha de alta</span>
          </div>
          <div class="kpi">
            <span class="kpi-label">Actualizado</span>
            <span class="kpi-value">{{ workspace.updatedAt | date:'short' }}</span>
            <span class="kpi-meta">Ultimo cambio</span>
          </div>
        </div>
        <div class="panel-row">
          <div class="kpi success">
            <span class="kpi-label">ID</span>
            <span class="kpi-value small">{{ workspace.id }}</span>
            <span class="kpi-meta">Referencia unica</span>
          </div>
        </div>
      </div>
    </header>

    <section class="panel section">
      <div class="panel-header">
        <h2>General</h2>
        <span class="chip">Settings</span>
      </div>

      <form [formGroup]="workspaceForm" (ngSubmit)="onSubmit()" class="form-content">
        <div class="icon-upload">
          <div class="icon-preview">
            @if (workspaceForm.get('image')?.value) {
              <div class="preview-image">
                <img [src]="workspaceForm.get('image')?.value" alt="Workspace Icon" />
                <button type="button" (click)="removeImage()" class="remove-icon-btn">
                  <i class="pi pi-times"></i>
                </button>
              </div>
            } @else {
              <div class="preview-placeholder">
                <span>{{ workspaceForm.get('name')?.value?.[0] || 'W' }}</span>
              </div>
            }
            <button
              type="button"
              (click)="fileInput.click()"
              class="edit-icon-btn"
              [disabled]="isUploading">
              <i class="pi" [ngClass]="isUploading ? 'pi-spin pi-spinner' : 'pi-camera'"></i>
            </button>
            <input
              #fileInput
              type="file"
              (change)="onFileSelected($event)"
              accept=".jpg, .jpeg, .png, .svg"
              class="hidden" />
          </div>
          <div class="icon-info">
            <p class="info-label">Workspace Icon</p>
            <p class="info-description">JPG, PNG, SVG o JPEG. Max 1MB.</p>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-field">
            <label for="name">Workspace Name <span class="required">*</span></label>
            <input
              type="text"
              id="name"
              formControlName="name"
              placeholder="Enter workspace name"
              class="form-input"
              maxlength="30" />
            @if (workspaceForm.get('name')?.invalid && workspaceForm.get('name')?.touched) {
              <span class="error-message">
                <i class="pi pi-exclamation-circle"></i>
                Workspace name is required (max 30 characters)
              </span>
            }
          </div>

          <div class="form-field">
            <label for="description">Description</label>
            <textarea
              id="description"
              formControlName="description"
              placeholder="Describe your workspace..."
              class="form-textarea"
              rows="4"></textarea>
            <span class="helper-text">
              <i class="pi pi-info-circle"></i>
              Una descripcion breve del workspace
            </span>
          </div>
        </div>

        <div class="form-actions">
          <button
            type="submit"
            class="btn primary"
            [disabled]="workspaceForm.invalid || isUploading">
            <i class="pi pi-save mr-2"></i>
            Guardar cambios
          </button>
        </div>
      </form>
    </section>

    <section class="panel danger">
      <div class="panel-header">
        <h2>Danger Zone</h2>
        <span class="chip danger">Riesgo</span>
      </div>
      <div class="danger-content">
        <div>
          <p class="danger-title">Delete Workspace</p>
          <p class="danger-description">
            Esta accion es irreversible. Se eliminaran datos, proyectos, tareas e issues.
          </p>
        </div>
        <button type="button" (click)="toggleModal()" class="btn danger">
          <i class="pi pi-trash mr-2"></i>
          Delete Workspace
        </button>
      </div>
    </section>
  }

  @if (!loading && !workspace && error) {
    <div class="state-card error">
      <i class="pi pi-exclamation-triangle"></i>
      <p>{{ error }}</p>
      <button (click)="ngOnInit()" class="btn primary">
        <i class="pi pi-refresh mr-2"></i>
        Retry
      </button>
    </div>
  }
</section>

@if (showModal) {
  <app-modal-delete-workspace
    (close)="toggleModal()"
    (deleteConfirmed)="handleDelete()">
  </app-modal-delete-workspace>
}
