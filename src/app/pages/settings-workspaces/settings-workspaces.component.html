<div class="settings-container">
  @if (successMessage) {
    <div class="notification success">
      <i class="pi pi-check-circle mr-2"></i>
      {{ successMessage }}
    </div>
  }

  @if (error && !loading) {
    <div class="notification error">
      <i class="pi pi-exclamation-triangle mr-2"></i>
      {{ error }}
    </div>
  }

  @if (loading) {
    <div class="loading-state">
      <i class="pi pi-spin pi-spinner text-4xl text-blue-500"></i>
      <p class="text-slate-600 mt-4">Loading workspace settings...</p>
    </div>
  }

  @if (!loading && workspace) {
    <div class="settings-header">
      <div class="header-content">
        <div class="header-info">
          <div class="workspace-icon">
            @if (workspace.image) {
              <img [src]="workspace.image" alt="{{workspace.name}}" />
            } @else {
              <span class="icon-placeholder">{{ workspace.name[0] }}</span>
            }
          </div>
          <div>
            <h1 class="title">{{ workspace.name }}</h1>
            <p class="subtitle">Workspace Settings</p>
          </div>
        </div>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="pi pi-calendar"></i>
        </div>
        <div>
          <p class="stat-label">Created</p>
          <p class="stat-value">{{ workspace.createdAt | date:'short' }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <i class="pi pi-clock"></i>
        </div>
        <div>
          <p class="stat-label">Last Updated</p>
          <p class="stat-value">{{ workspace.updatedAt | date:'short' }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <i class="pi pi-hashtag"></i>
        </div>
        <div>
          <p class="stat-label">Workspace ID</p>
          <p class="stat-value-small">{{ workspace.id }}</p>
        </div>
      </div>
    </div>

    <div class="settings-section">
      <form [formGroup]="workspaceForm" (ngSubmit)="onSubmit()">
        <div class="section-header">
          <i class="pi pi-cog"></i>
          <h2>General Settings</h2>
        </div>

        <div class="form-content">
          <div class="icon-upload-section">
            <div class="icon-preview">
              @if (workspaceForm.get('image')?.value) {
                <div class="preview-image">
                  <img [src]="workspaceForm.get('image')?.value" alt="Workspace Icon" />
                  <button
                    type="button"
                    (click)="removeImage()"
                    class="remove-icon-btn"
                    title="Remove image">
                    <i class="pi pi-times"></i>
                  </button>
                </div>
              } @else {
                <div class="preview-placeholder">
                  <span>{{ workspaceForm.get('name')?.value?.[0] || 'W' }}</span>
                </div>
              }
              <button
                type="button"
                (click)="fileInput.click()"
                class="edit-icon-btn"
                [disabled]="isUploading"
                title="Change workspace icon">
                <i class="pi" [ngClass]="isUploading ? 'pi-spin pi-spinner' : 'pi-camera'"></i>
              </button>
              <input
                #fileInput
                type="file"
                (change)="onFileSelected($event)"
                accept=".jpg, .jpeg, .png, .svg"                title="Upload workspace icon"                class="hidden" />
            </div>
            <div class="icon-info">
              <p class="info-label">Workspace Icon</p>
              <p class="info-description">JPG, PNG, SVG or JPEG. Max 1MB</p>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-field full-width">
              <label for="name">Workspace Name <span class="required">*</span></label>
              <input
                type="text"
                id="name"
                formControlName="name"
                placeholder="Enter workspace name"
                class="form-input"
                maxlength="30" />
              @if (workspaceForm.get('name')?.invalid && workspaceForm.get('name')?.touched) {
                <span class="error-message">
                  <i class="pi pi-exclamation-circle"></i>
                  Workspace name is required (max 30 characters)
                </span>
              }
            </div>

            <div class="form-field full-width">
              <label for="description">Description</label>
              <textarea
                id="description"
                formControlName="description"
                placeholder="Describe your workspace..."
                class="form-textarea"
                rows="4"></textarea>
              <span class="helper-text">
                <i class="pi pi-info-circle"></i>
                A brief description of what this workspace is used for
              </span>
            </div>
          </div>

          <div class="form-actions">
            <button
              type="submit"
              class="btn-primary"
              [disabled]="workspaceForm.invalid || isUploading">
              <i class="pi pi-save mr-2"></i>
              Save Changes
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Danger Zone -->
    <div class="danger-zone">
      <div class="section-header danger">
        <i class="pi pi-exclamation-triangle"></i>
        <h2>Danger Zone</h2>
      </div>
      <div class="danger-content">
        <div class="danger-info">
          <p class="danger-title">Delete Workspace</p>
          <p class="danger-description">
            Once you delete a workspace, there is no going back. This action is irreversible and will
            permanently remove all data, projects, tasks, and issues associated with this workspace.
          </p>
        </div>
        <button
          type="button"
          (click)="toggleModal()"
          class="btn-danger">
          <i class="pi pi-trash mr-2"></i>
          Delete Workspace
        </button>
      </div>
    </div>
  }

  @if (!loading && !workspace && error) {
    <div class="error-state">
      <i class="pi pi-exclamation-triangle text-4xl text-red-500"></i>
      <p class="text-red-600 mt-4">{{ error }}</p>
      <button (click)="ngOnInit()" class="retry-btn mt-4">
        <i class="pi pi-refresh mr-2"></i>
        Retry
      </button>
    </div>
  }
</div>

@if (showModal) {
  <app-modal-delete-workspace
    (close)="toggleModal()"
    (deleteConfirmed)="handleDelete()">
  </app-modal-delete-workspace>
}
