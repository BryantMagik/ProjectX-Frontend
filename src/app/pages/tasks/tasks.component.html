<div class="tasks-container">
  <div class="tasks-header">
    <div class="header-content">
      <div class="header-title">
        <i class="pi pi-check-square text-3xl"></i>
        <div>
          <h1 class="title">My Tasks</h1>
          <p class="subtitle">Manage and track your assigned tasks</p>
        </div>
      </div>
      <button class="btn-primary" (click)="navigateToTaskForm()">
        <i class="pi pi-plus"></i>
        New Task
      </button>
    </div>
  </div>

  <div class="filters-section">
    <div class="search-box">
      <i class="pi pi-search search-icon"></i>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()"
        placeholder="Search tasks by code or summary..."
        class="search-input"
      />
    </div>

    <div class="filter-group">
      <select
        [(ngModel)]="selectedStatus"
        (ngModelChange)="onStatusChange()"
        class="filter-select"
        title="Filter by status">
        <option value="all">All Status</option>
        <option value="Active">Active</option>
        <option value="Ongoing">Ongoing</option>
        <option value="Completed">Completed</option>
        <option value="Inactive">Inactive</option>
      </select>

      <select
        [(ngModel)]="selectedPriority"
        (ngModelChange)="onPriorityChange()"
        class="filter-select"
        title="Filter by priority">
        <option value="all">All Priorities</option>
        <option value="high">High</option>
        <option value="medium">Medium</option>
        <option value="low">Low</option>
      </select>
    </div>
  </div>

  <div class="stats-cards">
    <div class="stat-card">
      <div class="stat-icon stat-total">
        <i class="pi pi-list"></i>
      </div>
      <div class="stat-info">
        <p class="stat-value">{{ filteredTasks.length }}</p>
        <p class="stat-label">Total Tasks</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-active">
        <i class="pi pi-clock"></i>
      </div>
      <div class="stat-info">
        <p class="stat-value">{{ getActiveTasksCount() }}</p>
        <p class="stat-label">Active</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-completed">
        <i class="pi pi-check-circle"></i>
      </div>
      <div class="stat-info">
        <p class="stat-value">{{ getCompletedTasksCount() }}</p>
        <p class="stat-label">Completed</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-high">
        <i class="pi pi-exclamation-triangle"></i>
      </div>
      <div class="stat-info">
        <p class="stat-value">{{ getHighPriorityTasksCount() }}</p>
        <p class="stat-label">High Priority</p>
      </div>
    </div>
  </div>

  @if (loading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading your tasks...</p>
    </div>
  }

  @if (error && !loading) {
    <div class="error-state">
      <i class="pi pi-exclamation-circle"></i>
      <p>{{ error }}</p>
    </div>
  }

  @if (!loading && !error) {
    @if (filteredTasks.length === 0) {
      <div class="empty-state">
        <i class="pi pi-inbox"></i>
        <h3>No tasks found</h3>
        <p>{{ searchTerm || selectedStatus !== 'all' || selectedPriority !== 'all' ? 'Try adjusting your filters' : 'Create your first task to get started' }}</p>
        @if (!searchTerm && selectedStatus === 'all' && selectedPriority === 'all') {
          <button class="btn-secondary" (click)="navigateToTaskForm()">
            <i class="pi pi-plus"></i>
            Create Task
          </button>
        }
      </div>
    } @else {
      <div class="tasks-grid">
        @for (task of filteredTasks; track task.id) {
          <div class="task-card" (click)="navigateToTaskDetails(task.id)" title="View Task Details">
            <div class="task-header">
              <span class="task-code">{{ task.code }}</span>
              <span class="task-priority" [ngClass]="getPriorityClass(task.priority)">
                {{ task.priority }}
              </span>
            </div>

            <h3 class="task-title">{{ task.summary }}</h3>

            @if (task.description) {
              <p class="task-description">{{ task.description }}</p>
            }

            <div class="task-footer">
              <div class="task-meta">
                <div class="meta-item">
                  <i class="pi pi-user"></i>
                  <span>{{ task.creator.first_name || 'Unassigned' }}</span>
                </div>
              </div>
              <span class="task-status" [ngClass]="getStatusClass(task.status)">
                {{ task.status }}
              </span>
            </div>
          </div>
        }
      </div>
    }
  }
</div>
